# 一些说明

# 用户生成界面
- 海报生成使用的Canvas.drawImage方法:
* 获取用户所在地，从而获取所在地的海报生成数据
* 获取用户授权信息
* 判断用户输入的工号是否存在
* 根据用户所在地海报的生成数据，下载海报背景图，绘制背景图，二维码则是将后台返回的base64二维码数据wx.getFileSystemManager().writeFile()写入本地后，返回本地路径，再做绘制
+ 绘制时，可能因机型的性能原因，故设置了背景图压缩率、延迟，画质等数据。主要数据为延迟和画质
+ 同时也会进行多次尝试绘制，直到到达一定失败次数后，放弃生成
* image组件显示绘制的文件，用户点击保存按钮即可保存

## 异常返回值：`{"errorCode":"200092","errorMessage":"工号不存在,请重新输入","success":false}`

# 海报数据界面
- 获取用户选择的所在地的海报生成数据
- 修改的·位置·缩放·参数只会在当前页面生效，除非进行了数据提交
- 上传的图片也是只在当前页面生效，除非进行了数据提交
* 如果该地区是后台新添加的，则在数据提交时提示用户，这条数据时添加而非修改。
## 因云开发的限制，需要同一个openi用户才能对数据进行修改。故需要了解到用户的openid

# 小程序基础数据界面
- 界面打开权限由数据库中的_id`_MINI_POSTER_BASIC_DATA_ID`，字段`_openid`决定
- 涉及到`地区海报管理界面打开密码`,`获取二维码的后台请求地址`,`公告标题`,`公告具体内容`


# 更新日志

### 2020年4月13日 V0.0.1
- 初版完成，具体功能为：
	- 用户输入工号后，点击按钮即可生成海报。
	- 生成海报后，可点击保存按钮保存海报到手机


### 2020年4月14日 V0.0.13
- 因用户可能会直接通过微信的端PC，生成海报，然后展示二维码给客户扫描。上一个版本的海报生成方式不适用。
	- 修改海报的展示样式
	- ✚添加直接展示二维码的弹窗

### 2020年4月24日 V0.1.0
- 因服务器提供服务存在不稳定的情况，故全面使用腾讯云服务进行开发。
- ✚添加海报生成参数配置界面
	- 需要输入正确的密码才能进入配置界面
	- 配置界面获取的参数为当前海报生成的参数，图片为当前海报生成的图片
	- 用户上传图片后，将会与后台换取图片下载链接，替换掉当前海报生成的图片链接。
	- 只有按下‘提交最终数据’按钮后，海报的生成数据才会更新。


### 2020年4月24日 V0.1.1
- 添加实时日志
- 将二维码请求链接修改为https
- 修改项目文件夹名称为：qrcode-to-poster


### 2020年5月7日 V0.1.2
- 修正：`_app.showModal('海报生成失败，请稍后再试',JSON.stringify(e));` 修正为 `_app.showModal(JSON.stringify(e),'海报生成失败，请稍后再试');`

### 2020年5月7日 V0.1.3
- 实时日志生成异常，修改生成方式，由`import {getSharePoster} from '@/util/wxLog/wxLog.js';`改为`var wxlog = require('@/util/wxLog/wxLog.js');`
- 修改获取基础数据的一些功能上的逻辑

### 2020年5月13日 V0.1.4
- 因后台业务调整，生成二维码的方式做出了变化
- ✚添加二维码链接数据库地址
- 修复部分机型海报生成失败的问题，`QS-SharePoster`中的`function getSharePoster(obj) {}`，重试次数增加至6次，每次尝试绘画都将设置`obj.bgScale`参数控制比例，同时按照`qrCodeOverride`的比例缩小二维码的大小


### 2020年5月14日 v0.2.1
- 生成二维码和海报之前，先获取用户的基础信息


### 2020年6月14日 v0.3.0
- 全面改写海报生成方式，适配低性能手机
- ✚超级管理员界面，管理小程序基础数据
- ✚用户地区所在地选项，方便后期多地区拓展
- 精简代码和资源，避免冗余