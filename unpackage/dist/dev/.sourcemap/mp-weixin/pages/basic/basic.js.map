{"version":3,"sources":["uni-app:///main.js","webpack:///F:/HBuilderX/qrcode-to-poster/pages/basic/basic.vue?180a","webpack:///F:/HBuilderX/qrcode-to-poster/pages/basic/basic.vue?9af1","webpack:///F:/HBuilderX/qrcode-to-poster/pages/basic/basic.vue?fa66","webpack:///F:/HBuilderX/qrcode-to-poster/pages/basic/basic.vue?960c","uni-app:///pages/basic/basic.vue"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,4F;AACAA,UAAU,CAACC,cAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;;;AAGpD;AACoL;AACpL,gBAAgB,6LAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAA0qB,CAAgB,+rBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACwH9rB,sE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAHA;AACA,qD,CAUA;AACA,mBACA,sBADA,C,CAEA;AACA,mC,CACA;AACA,6BACA,6BADA,I,CAGA;AACA,2B,eAEA,EACA,IADA,kBACA,CACA,SACA;AACA,wCAFA,EAGA;AACA,wBAJA,EAKA;AACA,wBANA,EAOA;AACA,wBARA,EAUA;AACA,2BAXA,EAaA;AACA,2BAdA,EAgBA;AACA;AAEA;;SAnBA,CAwBA;AACA,2BACA;AACA,gBAFA,EAGA;AACA,iBAJA,EAKA;AACA,kCANA,EAOA;AACA,uBARA,EASA;AACA,4BAVA,EAWA;AACA,yBAZA,EAzBA,EAyCA;;gCAzCA,CA4CA;AACA,qBACA;AACA,uBAFA,EAGA;AACA,qBAJA,EAKA;AACA,kBANA,EAOA;AACA,kBARA,EA7CA,GAyDA,CA3DA,EA4DA;AACA,mBA7DA,+BA6DA,CACA,+BACA,CA/DA,EAgEA;AACA,SAjEA,qBAiEA,CACA,aACA,4BACA,kBACA,UADA,EAEA,eAFA,IAHA,CAOA;AACA,iEACA,qCACA,oCACA,+CACA,iBACA,wBADA,EAEA,OAFA,mBAEA,GAFA,EAEA,CACA,oBACA,gBACA,kBADA,EAEA,iBAFA,IAIA,OACA,CACA,iCACA,+BACA,CAZA,EAaA,IAbA,gBAaA,CAbA,EAaA,CACA,gBACA,kBADA,EAEA,iBAFA,IADA,CAKA;AACA,WAnBA,IAqBA,CAzBA,EA0BA,wBACA,8BACA,gBACA,qCADA,EAEA,mBAFA,IAIA,CAhCA,EAiCA,+BACA,kBACA,CAnCA,IAqCA,CA9GA,EA+GA,WACA;;gOAGA,cAJA,4BAIA,CACA,kBACA,YADA,EAEA,UAFA,IAIA,wBACA,qBADA,EAEA,gCACA,uBACA,uBADA,EAEA,6BACA,mBACA,CAJA,IAMA,CATA,EAUA,0BACA;AACA,wCADA;AAEA,+BAFA;AAGA,6BAHA;;AAKA,SAhBA;AAiBA;AACA;AACA,SAnBA;;AAqBA,KA9BA;AA+BA;;;AAGA,0BAlCA,oCAkCA;AACA;AACA;AACA,4BADA;AAEA,2BAFA;;AAIA;AACA;AACA;;AAEA;AACA;AACA,gDAFA;AAGA,SAHA,CAGA;AACA;AACA;AACA;AACA;AACA,6BADA;AAEA,wGAFA;AAGA,+BAHA;;AAKA;AACA;AACA;AACA,sBAFA;AAGA;AACA,uBAJA;AAKA;AACA,wCANA;AAOA;AACA,6BARA;AASA;AACA,kCAVA;AAWA;AACA,+BAZA;;AAcA;AACA;AACA,6BAFA;AAGA;AACA,2BAJA;AAKA;AACA,wBANA;AAOA;AACA,wBARA;;AAUA;;AAEA,WAjCA,MAiCA;AACA;AACA;AACA;AACA;AACA,mDADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eATA;AAUA;AACA;AACA;AACA;AACA,8DADA;AAEA,mCAFA;;AAIA,eAjBA;;AAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SApEA;AAqEA;AACA;AACA;AACA,+DADA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","file":"pages/basic/basic.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/basic/basic.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./basic.vue?vue&type=template&id=d0eba70c&\"\nvar renderjs\nimport script from \"./basic.vue?vue&type=script&lang=js&\"\nexport * from \"./basic.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"F:/HBuilderX/qrcode-to-poster/pages/basic/basic.vue\"\nexport default component.exports","export * from \"-!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./basic.vue?vue&type=template&id=d0eba70c&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./basic.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\Program Files\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./basic.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<!-- 二维码位置参数 -->\r\n\t\t<view>\r\n\t\t\t<view class=\"cu-bar margin-top bg-white\">\r\n\t\t\t\t<view class=\"action\">\r\n\t\t\t\t\t<text class=\"cuIcon-title text-blue\"></text>二维码位置参数\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<form>\r\n\t\t\t\t<!-- <text>当前海报图的分辨率为：高{{POSTER_IMAGE_INFO.height}},宽{{POSTER_IMAGE_INFO.width}}</text> -->\r\n\t\t\t\t<view class=\"cu-form-group\">\r\n\t\t\t\t\t<view class=\"title\">所在地区</view>\r\n\t\t\t\t\t<picker @change=\"areaPickerChange\" :value=\"areaPickerIndex\" :range=\"areaPickerList\" v-bind:range-key=\"'areaName'\">\r\n\t\t\t\t\t\t<view class=\"picker\">\r\n\t\t\t\t\t\t\t{{areaPickerList[areaPickerIndex].areaName}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</picker>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"cu-form-group\">\r\n\t\t\t\t\t<view class=\"title\">在X轴的位置</view>\r\n\t\t\t\t\t<input placeholder=\"数据从0到1\" type=\"digit\" name=\"qrCodeX\" v-model=\"QRCODE_INFO.qrCodeX\"></input>\r\n\t\t\t\t\t<view class=\"cu-tag line-blue\">\r\n\t\t\t\t\t\t数值越大越靠右\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"cu-form-group\">\r\n\t\t\t\t\t<view class=\"title\">在Y轴的位置</view>\r\n\t\t\t\t\t<input placeholder=\"数据从0到1\" type=\"digit\" name=\"qrCodeY\" v-model=\"QRCODE_INFO.qrCodeY\"></input>\r\n\t\t\t\t\t<view class=\"cu-tag line-blue\">\r\n\t\t\t\t\t\t数值越大越靠下\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"cu-form-group\">\r\n\t\t\t\t\t<view class=\"title\">二维码大小</view>\r\n\t\t\t\t\t<input placeholder=\"0\" type=\"number\" name=\"qrCodeSize\" v-model=\"QRCODE_INFO.qrCodeSize\"></input>\r\n\t\t\t\t\t<view class=\"cu-tag line-blue\">\r\n\t\t\t\t\t\t数值越大二维码越大\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<!-- <view class=\"cu-form-group padding flex flex-direction\">\r\n\t\t\t\t\t<button class=\"cu-btn bg-blue lg\">更新二维码位置参数</button>\r\n\t\t\t\t</view> -->\r\n\t\t\t\t<view class=\"cu-form-group padding\">\r\n\t\t\t\t\t<button class=\"cu-btn bg-cyan  cuIcon-upload shadow\" @tap=\"uploadFileToCloud\" :disabled=\"DISBALE_BUTTON\">上传新的海报</button>\r\n\t\t\t\t\t<button class=\"cu-btn bg-cyan shadow cuIcon-picfill\" @tap=\"downloadImageAndGetBase64AndDrawPoster\" :disabled=\"DISBALE_BUTTON\">预览生成效果</button>\r\n\t\t\t\t</view>\r\n\t\t\t</form>\r\n\r\n\t\t</view>\r\n\r\n\t\t<!-- 相关说明 -->\r\n\t\t<view>\r\n\t\t\t<view class=\"cu-bar margin-top bg-white\">\r\n\t\t\t\t<view class='action'>\r\n\t\t\t\t\t<text class='cuIcon-title text-blue'></text>相关说明\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"padding bg-white\">\r\n\t\t\t\t<view>1.点击\r\n\t\t\t\t\t<button class=\"cu-btn bg-green round shadow cuIcon-check\" @tap=\"updateBasicSQL\" :disabled=\"DISBALE_BUTTON\">提交最终数据</button>\r\n\t\t\t\t\t来更新用户端海报的生成方式。\r\n\t\t\t\t</view>\r\n\t\t\t\t<view>2.点击<button class=\"cu-btn round line-purple margin-top \" @tap=\"showBASICt_DATA\">二维码位置数据参考图</button>来查看二维码在海报各个位置的参数。\r\n\t\t\t\t\t但是二维码的位置也会因为海报的大小、形状，以及二维码缩放程度的不同，而导致位置参数的不同。故此处的数据只能做参考。\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 其他数据 -->\r\n\t\t<view>\r\n\t\t\t<!-- 数据模板 -->\r\n\t\t\t<view class=\"flex_row_c_c modalView\" :class=\"BASICt_DATA?'show':''\">\r\n\t\t\t\t<view class=\"flex_column\">\r\n\t\t\t\t\t<view class=\"backgroundColor-white padding1vh border_radius_10px\">\r\n\t\t\t\t\t\t<image src=\"cloud://qrcode-to-poster-luody.7172-qrcode-to-poster-luody-1301853898/基础信息/基础位置信息2.PNG\" mode=\"widthFix\"\r\n\t\t\t\t\t\t class=\"posterImage\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"flex_row marginTop2vh\">\r\n\t\t\t\t\t\t<button type=\"default\" size=\"mini\" @tap.prevent.stop=\"hideBASICt_DATA()\">关闭</button>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\r\n\r\n\t\t\t<!--当前海报背景图的展示组件-->\r\n\t\t\t<view class=\"padding bg-white\" style=\"width: 100%\">\r\n\t\t\t\t<image v-if=\"POSTER_IMAGE_INFO.posterImgDownloadUrl\" :src=\"POSTER_IMAGE_INFO.posterImgDownloadUrl\"></image>\r\n\t\t\t</view>\r\n\t\t\t<!--海报的绘制组件-->\r\n\t\t\t<view class=\"hideCanvasView\">\r\n\t\t\t\t<canvas canvas-id=\"CANVAS_ID\" class=\"hideCanvas\" s style=\"border: 1px solid; background: #00aaff;\" :style=\"{width: (POSTER_IMAGE_INFO.width||10) + 'px', height: (POSTER_IMAGE_INFO.height||10) + 'px'}\"></canvas>\r\n\t\t\t</view>\r\n\t\t\t<!--生成海报后的展示组件 -->\r\n\t\t\t<view>\r\n\t\t\t\t<view class=\"flex_row_c_c modalView\" :class=\"POSTER_IMAGE_INFO.posterShow?'show':''\">\r\n\t\t\t\t\t<view class=\"flex_column\">\r\n\t\t\t\t\t\t<view class=\"backgroundColor-white padding1vh border_radius_10px\">\r\n\t\t\t\t\t\t\t<image :src=\"POSTER_IMAGE_INFO.posterUrl || ''\" mode=\"widthFix\" class=\"posterImage\" @longtap=\"saveImage()\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"flex_row marginTop2vh\">\r\n\t\t\t\t\t\t\t<button type=\"warn\" size=\"mini\" @tap.prevent.stop=\"hidePoster()\">关闭</button>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 用户代码 -->\r\n\t\t<view class=\" text-sm padding\">\r\n\t\t\t<button class=\"cu-btn text-grey cuIcon-copy\" @tap=\"copyUserOpenId\">复制用户OPENID到剪切板</button>\r\n\t\t\t<button class='cu-btn text-grey' @tap=\"updateAdminData\">超级管理员</button>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\t//微信日志输出\r\n\tconst wxlog = require('../log.js');\r\n\r\n\timport {\r\n\t\tgetUserInfo,\r\n\t\tdownLoadAndSaveFile,\r\n\t\tgetQRCodeBase64,\r\n\t\twriteBase64ToFile,\r\n\t\tcanvasToImageFile,\r\n\t\tdownloadImageAndGetBase64AndDrawPoster\r\n\t} from '../../util/js_tools.js'\r\n\t// 全局变量\r\n\tvar _this = this,\r\n\t\tadminUserOpenId = null;\r\n\t// 数据库名称\r\n\tconst SQL_DATA_NAME = 'qrcode_basic';\r\n\t// 操作的数据库为 qrcode-to-poster-luody\r\n\tconst db = wx.cloud.database({\r\n\t\tenv: 'qrcode-to-poster-luody'\r\n\t});\r\n\t//当前用户选择的所在地的数据ID\r\n\tvar NowUserAreaDataToSQLId;\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t// 画布的ID\r\n\t\t\t\tcanvasId: 'default_PosterCanvasId',\r\n\t\t\t\t// 地区列表\r\n\t\t\t\tareaPickerList: [],\r\n\t\t\t\t// 用户选择的地区\r\n\t\t\t\tareaPickerIndex: 0,\r\n\t\t\t\t//基础位置信息\r\n\t\t\t\tBASICt_DATA: false,\r\n\r\n\t\t\t\t// 用户工号\r\n\t\t\t\tUSER_NAME: '01059101',\r\n\r\n\t\t\t\t// 按钮禁用状态\r\n\t\t\t\tDISBALE_BUTTON: false,\r\n\r\n\t\t\t\t//自动保存海报\r\n\t\t\t\t//autoSavePoster:false,\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * 海报\r\n\t\t\t\t */\r\n\r\n\r\n\t\t\t\t// 海报信息\r\n\t\t\t\tPOSTER_IMAGE_INFO: {\r\n\t\t\t\t\t// 海报的宽\r\n\t\t\t\t\twidth: 0,\r\n\t\t\t\t\t// 海报的高\r\n\t\t\t\t\theight: 0,\r\n\t\t\t\t\t// 海报下载地址\r\n\t\t\t\t\tposterImgDownloadUrl: null,\r\n\t\t\t\t\t// 展示海报时的路径\r\n\t\t\t\t\tposterUrl: null,\r\n\t\t\t\t\t// 海报云路径\r\n\t\t\t\t\tposterCloudUrl: null,\r\n\t\t\t\t\t// 海报是否展示\r\n\t\t\t\t\tposterShow: false,\r\n\t\t\t\t},\r\n\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * 二维码\r\n\t\t\t\t */\r\n\t\t\t\t// 二维码大小\r\n\t\t\t\tQRCODE_INFO: {\r\n\t\t\t\t\t// 二维码生成的后台地址\r\n\t\t\t\t\tqrCodeUrl: null,\r\n\t\t\t\t\t// 二维码大小\r\n\t\t\t\t\tqrCodeSize: 0,\r\n\t\t\t\t\t// 二维码X位置\r\n\t\t\t\t\tqrCodeX: 0,\r\n\t\t\t\t\t// 二维码Y位置\r\n\t\t\t\t\tqrCodeY: 0\r\n\t\t\t\t},\r\n\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 下拉刷新数据\r\n\t\tonPullDownRefresh() {\r\n\t\t\t_this.getBasicDataByUserArea();\r\n\t\t},\r\n\t\t// 每次mounted都获取基础数据\r\n\t\tmounted() {\r\n\t\t\t_this = this;\r\n\t\t\t_this.DISBALE_BUTTON = true;\r\n\t\t\tuni.showLoading({\r\n\t\t\t\tmask: true,\r\n\t\t\t\ttitle: '获取地区数据'\r\n\t\t\t})\r\n\t\t\t// 获取所有地区\r\n\t\t\tdb.collection(SQL_DATA_NAME).doc('_MINI_AREA_DATA_ID').get({\r\n\t\t\t\tsuccess: function(list_res) {\r\n\t\t\t\t\twxlog.info(list_res.data._areaData)\r\n\t\t\t\t\t_this.areaPickerList = list_res.data._areaData;\r\n\t\t\t\t\tuni.getStorage({\r\n\t\t\t\t\t\tkey: '_USER_SELECT_AREA',\r\n\t\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\t\tif (res.data == 0) {\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\ttitle: '获取用户所在地失败',\r\n\t\t\t\t\t\t\t\t\tcontent: '请选择所在地'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t_this.areaPickerIndex = res.data;\r\n\t\t\t\t\t\t\t_this.getBasicDataByUserArea();\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(e) {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '获取用户所在地失败',\r\n\t\t\t\t\t\t\t\tcontent: '请选择所在地'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t// _this.areaPickerIndex=1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tfail: function(e) {\r\n\t\t\t\t\twxlog.error('获取下拉地区数据失败：', e);\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: \"请稍后再试：\" + JSON.stringify(e),\r\n\t\t\t\t\t\ttitle: \"获取下拉地区数据失败\"\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\tcomplete: function() {\r\n\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * 复制用户openid\r\n\t\t\t */\r\n\t\t\tcopyUserOpenId() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '获取中',\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t})\r\n\t\t\t\twx.cloud.callFunction({\r\n\t\t\t\t\tname: 'getUserInfoJs',\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tuni.setClipboardData({\r\n\t\t\t\t\t\t\tdata: res.result.openid,\r\n\t\t\t\t\t\t\tsuccess: function() {\r\n\t\t\t\t\t\t\t\twxlog.info('复制成功');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: res => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: JSON.stringify(res),\r\n\t\t\t\t\t\t\ttitle: '获取OPENID失败',\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: res => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 根据用户所在地获取海报生成信息\r\n\t\t\t */\r\n\t\t\tgetBasicDataByUserArea() {\r\n\t\t\t\tif (_this.areaPickerIndex == 0) {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\ttitle: '获取用户所在地失败',\r\n\t\t\t\t\t\tcontent: '请选择所在地'\r\n\t\t\t\t\t})\r\n\t\t\t\t\t_this.DISBALE_BUTTON = true;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdb.collection(SQL_DATA_NAME).where({\r\n\t\t\t\t\t//_id:'_MINI_TEST_POSTER_SHARE',\r\n\t\t\t\t\t_areaId: parseInt(_this.areaPickerIndex)\r\n\t\t\t\t}).get({\r\n\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\twxlog.info(res);\r\n\t\t\t\t\t\tif (res.data.length == 0) {\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\ttitle: '获取数据失败',\r\n\t\t\t\t\t\t\t\tcontent: '获取当前选择地区\"' + _this.areaPickerList[_this.areaPickerIndex].areaName + '\"的海报生成参数失败',\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tNowUserAreaDataToSQLId = null;\r\n\t\t\t\t\t\t\t_this.POSTER_IMAGE_INFO = {\r\n\t\t\t\t\t\t\t\t// 海报的宽\r\n\t\t\t\t\t\t\t\twidth: 0,\r\n\t\t\t\t\t\t\t\t// 海报的高\r\n\t\t\t\t\t\t\t\theight: 0,\r\n\t\t\t\t\t\t\t\t// 海报下载地址\r\n\t\t\t\t\t\t\t\tposterImgDownloadUrl: null,\r\n\t\t\t\t\t\t\t\t// 展示海报时的路径\r\n\t\t\t\t\t\t\t\tposterUrl: null,\r\n\t\t\t\t\t\t\t\t// 海报云路径\r\n\t\t\t\t\t\t\t\tposterCloudUrl: null,\r\n\t\t\t\t\t\t\t\t// 海报是否展示\r\n\t\t\t\t\t\t\t\tposterShow: false,\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t_this.QRCODE_INFO = {\r\n\t\t\t\t\t\t\t\t// 二维码生成的后台地址\r\n\t\t\t\t\t\t\t\tqrCodeUrl: null,\r\n\t\t\t\t\t\t\t\t// 二维码大小\r\n\t\t\t\t\t\t\t\tqrCodeSize: 0,\r\n\t\t\t\t\t\t\t\t// 二维码X位置\r\n\t\t\t\t\t\t\t\tqrCodeX: 0,\r\n\t\t\t\t\t\t\t\t// 二维码Y位置\r\n\t\t\t\t\t\t\t\tqrCodeY: 0\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t_this.DISBALE_BUTTON = false;\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconst posterSQL = res.data[0];\r\n\t\t\t\t\t\t\tNowUserAreaDataToSQLId = posterSQL._id;\r\n\t\t\t\t\t\t\t// 使用从数据库中获取到的图片ID换取海报背景的下载地址\r\n\t\t\t\t\t\t\twx.cloud.getTempFileURL({\r\n\t\t\t\t\t\t\t\tfileList: [posterSQL._posterCloudUrl],\r\n\t\t\t\t\t\t\t\t// 有效期设置为20小时\r\n\t\t\t\t\t\t\t\t// maxAge: 120 * 10 * 60 * 1000,\r\n\t\t\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\t\t\twxlog.info('res', res);\r\n\t\t\t\t\t\t\t\t\twxlog.info('res.fileList', res.fileList[0].tempFileURL);\r\n\t\t\t\t\t\t\t\t\t// 下载链接获取完成\r\n\t\t\t\t\t\t\t\t\t_this.POSTER_IMAGE_INFO.posterImgDownloadUrl = res.fileList[0].tempFileURL;\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: res => {\r\n\t\t\t\t\t\t\t\t\t_this.DISBALE_BUTTON = true;\r\n\t\t\t\t\t\t\t\t\twxlog.error('使用从数据库中获取到的图片ID换取下载地址失败：', res);\r\n\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\tcontent: \"获取海报下载地址失败：\" + JSON.stringify(res),\r\n\t\t\t\t\t\t\t\t\t\ttitle: \"获取基础数据异常\"\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t// 海报云地址\r\n\t\t\t\t\t\t\t_this.POSTER_IMAGE_INFO.posterCloudUrl = posterSQL._posterCloudUrl;\r\n\t\t\t\t\t\t\t// 二维码大小\r\n\t\t\t\t\t\t\t_this.QRCODE_INFO.qrCodeSize = posterSQL._qrCodeSize;\r\n\t\t\t\t\t\t\t// 二维码X位置\r\n\t\t\t\t\t\t\t_this.QRCODE_INFO.qrCodeX = posterSQL._qrCodeX;\r\n\t\t\t\t\t\t\t// 二维码Y位置\r\n\t\t\t\t\t\t\t_this.QRCODE_INFO.qrCodeY = posterSQL._qrCodeY;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: function(e) {\r\n\t\t\t\t\t\t_this.DISBALE_BUTTON = true;\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: \"根据用户所在地获取海报生成信息失败：\" + JSON.stringify(res),\r\n\t\t\t\t\t\t\ttitle: \"获取基础数据异常\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\twxlog.error('根据用户所在地获取海报生成信息失败', e)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: function(res) {\r\n\t\t\t\t\t\t_this.getMainBasicData();\r\n\t\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetMainBasicData() {\r\n\t\t\t\tdb.collection(SQL_DATA_NAME).doc('_MINI_POSTER_BASIC_DATA_ID').get({\r\n\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\twxlog.info('_MINI_POSTER_BASIC_DATA_ID数据：', res.data)\r\n\t\t\t\t\t\t// 管理员的openid\r\n\t\t\t\t\t\tadminUserOpenId = res.data._openid;\r\n\t\t\t\t\t\t// 二维码生成的后台地址\r\n\t\t\t\t\t\t_this.QRCODE_INFO.qrCodeUrl = res.data._qrCodeUrl;\r\n\t\t\t\t\t\t_this.DISBALE_BUTTON = false;\r\n\t\t\t\t\t\twxlog.info('_this.POSTER_IMAGE_INFO', _this.POSTER_IMAGE_INFO);\r\n\t\t\t\t\t\twxlog.info('_this.QRCODE_INFO', _this.QRCODE_INFO);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: function(e) {\r\n\t\t\t\t\t\t_this.DISBALE_BUTTON = true;\r\n\t\t\t\t\t\twxlog.error('获取下拉地区数据失败：', e);\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: \"请稍后再试：\" + JSON.stringify(e),\r\n\t\t\t\t\t\t\ttitle: \"获取下拉地区数据失败\"\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: function() {\r\n\t\t\t\t\t\tuni.stopPullDownRefresh();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 地区选择器\r\n\t\t\t * @param {Object} e\r\n\t\t\t */\r\n\t\t\tareaPickerChange(e) {\r\n\t\t\t\twxlog.info(e.detail.value)\r\n\t\t\t\t_this.areaPickerIndex = e.detail.value;\r\n\t\t\t\twxlog.info(_this.areaPickerList[e.detail.value].areaIndex);\r\n\t\t\t\tuni.setStorage({\r\n\t\t\t\t\tkey: '_USER_SELECT_AREA',\r\n\t\t\t\t\tdata: e.detail.value,\r\n\t\t\t\t\tsuccess: function() {\r\n\t\t\t\t\t\twxlog.info('用户所在地保存成功：' + _this.areaPickerIndex + ',' + _this.areaPickerList[e.detail.value]);\r\n\t\t\t\t\t\t// App.AREA_PICKER_INDEX = _this.areaPickerIndex;\r\n\t\t\t\t\t\t_this.getBasicDataByUserArea();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail(res) {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '保存用户所在地失败',\r\n\t\t\t\t\t\t\tcontent: JSON.stringify(res),\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 下载背景图，获取二维码，绘制海报\r\n\t\t\t */\r\n\t\t\tdownloadImageAndGetBase64AndDrawPoster() {\r\n\t\t\t\tgetUserInfo().then(function(data) {\r\n\t\t\t\t\t\tgetQRCodeBase64(_this.USER_NAME, _this.QRCODE_INFO.qrCodeUrl).then(function(res) {\r\n\t\t\t\t\t\t\t\tif (res.data.success == true) {\r\n\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\tdownloadImageAndGetBase64AndDrawPoster(_this);\r\n\t\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\t\tcontent: JSON.stringify(e),\r\n\t\t\t\t\t\t\t\t\t\t\ttitle: '生成海报失败',\r\n\t\t\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\tcontent: JSON.stringify(res.data.errorMessage),\r\n\t\t\t\t\t\t\t\t\t\ttitle: '生成海报失败',\r\n\t\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.catch(function(reason, data) {\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\tcontent: JSON.stringify(reason),\r\n\t\t\t\t\t\t\t\t\ttitle: '生成海报失败',\r\n\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\twxlog.info('获取用户信息rejected失败回调：', reason);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(function(reason, data) {\r\n\t\t\t\t\t\twxlog.info('获取用户信息rejected失败回调：', reason);\r\n\t\t\t\t\t});\r\n\t\t\t},\r\n\r\n\t\t\t// 上传图片\r\n\t\t\tuploadFileToCloud: function() {\r\n\t\t\t\twx.chooseImage({\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsizeType: ['original'],\r\n\t\t\t\t\tsourceType: ['album'],\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t// tempFilePath可以作为img标签的src属性显示图片\r\n\t\t\t\t\t\tconst tempFilePaths = res.tempFilePaths;\r\n\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\ttitle: '提交中'\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tconst promiseArr = [];\r\n\t\t\t\t\t\t_this.fileIDs = [];\r\n\t\t\t\t\t\t// 只能一张张上传 遍历临时的图片数组\r\n\t\t\t\t\t\tfor (let i = 0; i < tempFilePaths.length; i++) {\r\n\t\t\t\t\t\t\tlet filePath = tempFilePaths[i]\r\n\t\t\t\t\t\t\t// 正则表达式，获取文件扩展名\r\n\t\t\t\t\t\t\tlet suffix = /\\.[^\\.]+$/.exec(filePath)[0];\r\n\t\t\t\t\t\t\t// 在每次上传的时候，就往promiseArr里存一个promise，只有当所有的都返回结果时，才可以继续往下执行\r\n\t\t\t\t\t\t\tpromiseArr.push(new Promise((reslove, reject) => {\r\n\t\t\t\t\t\t\t\twx.cloud.uploadFile({\r\n\t\t\t\t\t\t\t\t\tcloudPath: new Date().getTime() + suffix,\r\n\t\t\t\t\t\t\t\t\t// 文件路径\r\n\t\t\t\t\t\t\t\t\tfilePath: filePath,\r\n\t\t\t\t\t\t\t\t}).then(res => {\r\n\t\t\t\t\t\t\t\t\t// 获取上传后返回的文件ID\r\n\t\t\t\t\t\t\t\t\twxlog.info(res.fileID);\r\n\t\t\t\t\t\t\t\t\t_this.fileIDs.push(res.fileID);\r\n\t\t\t\t\t\t\t\t\twxlog.info('获取上传后返回的文件ID', res);\r\n\t\t\t\t\t\t\t\t\treslove();\r\n\t\t\t\t\t\t\t\t}).catch(error => {\r\n\t\t\t\t\t\t\t\t\twxlog.info(error);\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tPromise.all(promiseArr).then(res => {\r\n\t\t\t\t\t\t\twxlog.info(res);\r\n\t\t\t\t\t\t\twxlog.info('_this.fileIDs', _this.fileIDs);\r\n\r\n\t\t\t\t\t\t\t_this.POSTER_IMAGE_INFO.posterCloudUrl = _this.fileIDs[0];\r\n\t\t\t\t\t\t\twxlog.info('上传后返回的图片ID：' + _this.POSTER_IMAGE_INFO.posterCloudUrl);\r\n\t\t\t\t\t\t\twx.cloud.getTempFileURL({\r\n\t\t\t\t\t\t\t\tfileList: [_this.POSTER_IMAGE_INFO.posterCloudUrl],\r\n\t\t\t\t\t\t\t\t// 有效期设置为20小时\r\n\t\t\t\t\t\t\t\tmaxAge: 120 * 10 * 60 * 1000,\r\n\t\t\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\t\t\t_this.POSTER_IMAGE_INFO.posterImgDownloadUrl = res.fileList[0].tempFileURL;\r\n\t\t\t\t\t\t\t\t\twxlog.info('转换成下载链接', TempFileURL);\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail: wxlog.error\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 取消显示海报\r\n\t\t\thidePoster() {\r\n\t\t\t\t_this.POSTER_IMAGE_INFO.posterShow = false;\r\n\t\t\t},\r\n\t\t\t// 显示基础数据模板\r\n\t\t\tshowBASICt_DATA() {\r\n\t\t\t\t_this.BASICt_DATA = true;\r\n\t\t\t},\r\n\t\t\t// 隐藏基础数据模板\r\n\t\t\thideBASICt_DATA() {\r\n\t\t\t\t_this.BASICt_DATA = false;\r\n\t\t\t},\r\n\t\t\t// 更新基础数据\r\n\t\t\tupdateBasicSQL() {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\tcontent: '确定提交当前的生成数据吗',\r\n\t\t\t\t\ttitle: '注意！',\r\n\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\twxlog.info('开始提交数据到数据库：' + SQL_DATA_NAME + '，ID为：' + NowUserAreaDataToSQLId + '的数据', _this.POSTER_IMAGE_INFO);\r\n\t\t\t\t\t\t\tif (String(NowUserAreaDataToSQLId) == '' || String(NowUserAreaDataToSQLId) == 'null') {\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\tcontent: '未获取到该地区原有海报生成数据的唯一性ID标志。是要添加该地区的海报生成数据吗?如果不是添加新数据，只是修改海报生成数据，请取消后，下拉刷新界面后再尝试更新',\r\n\t\t\t\t\t\t\t\t\ttitle: '☢注意☢',\r\n\t\t\t\t\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: '提交中'\r\n\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t_this.addPosterData();\r\n\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\t\t\tmask: true,\r\n\t\t\t\t\t\t\t\t\ttitle: '提交中'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t_this.updatePosterData();\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 更新海报数据\r\n\t\t\tupdatePosterData() {\r\n\t\t\t\tdb.collection(SQL_DATA_NAME).doc(NowUserAreaDataToSQLId).update({\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t// 海报云地址\r\n\t\t\t\t\t\t_posterCloudUrl: _this.POSTER_IMAGE_INFO.posterCloudUrl,\r\n\t\t\t\t\t\t// 二维码大小\r\n\t\t\t\t\t\t_qrCodeSize: _this.QRCODE_INFO.qrCodeSize,\r\n\t\t\t\t\t\t// X\r\n\t\t\t\t\t\t_qrCodeX: _this.QRCODE_INFO.qrCodeX,\r\n\t\t\t\t\t\t// Y\r\n\t\t\t\t\t\t_qrCodeY: _this.QRCODE_INFO.qrCodeY,\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\twxlog.info('res', res)\r\n\t\t\t\t\t\tif (res.errMsg == 'doc.update:ok' || res.errMsg == 'document.update:ok') {\r\n\t\t\t\t\t\t\tif (res.stats.updated == 0) {\r\n\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '没有数据被更新',\r\n\t\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\twxlog.info('没有数据被更新');\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\twxlog.info('更新成功');\r\n\t\t\t\t\t\t\t\t_this.getBasicDataByUserArea();\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle: '更新成功'\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\twxlog.error('更新失败');\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\tcontent: JSON.stringify(res),\r\n\t\t\t\t\t\t\t\ttitle: '更新失败',\r\n\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\r\n\r\n\t\t\t// 添加海报数据\r\n\t\t\taddPosterData() {\r\n\t\t\t\tdb.collection(SQL_DATA_NAME).add({\r\n\t\t\t\t\t// data 字段表示需新增的 JSON 数据\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t// _openid: res.result.openid,\r\n\t\t\t\t\t\t_areaId: Number(_this.areaPickerIndex || 0),\r\n\t\t\t\t\t\t_posterCloudUrl: String(_this.POSTER_IMAGE_INFO.posterCloudUrl || null),\r\n\t\t\t\t\t\t_qrCodeSize: Number(_this.QRCODE_INFO.qrCodeSize || 0),\r\n\t\t\t\t\t\t_qrCodeX: Number(_this.QRCODE_INFO.qrCodeX || 0),\r\n\t\t\t\t\t\t_qrCodeY: Number(_this.QRCODE_INFO.qrCodeY || 0)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function(res) {\r\n\t\t\t\t\t\twxlog.info('添加成功，返回ID为：', res);\r\n\t\t\t\t\t\t_this.getBasicDataByUserArea();\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '添加数据成功'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: function(e) {\r\n\t\t\t\t\t\twxlog.error('添加数据失败', e)\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: +JSON.stringify(e),\r\n\t\t\t\t\t\t\ttitle: '添加数据失败',\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: function(res) {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 跳转到超级管理员界面\r\n\t\t\tupdateAdminData() {\r\n\t\t\t\t// 校验用户的openid\r\n\t\t\t\twx.cloud.callFunction({\r\n\t\t\t\t\tname: 'getUserInfoJs',\r\n\t\t\t\t\tcomplete: res => {\r\n\t\t\t\t\t\tif (String(res.result.openid) == String(adminUserOpenId)) {\r\n\t\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\t\turl: '../adminTool/adminTool'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\t\t\ttitle: '权限不足'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\n"],"sourceRoot":""}